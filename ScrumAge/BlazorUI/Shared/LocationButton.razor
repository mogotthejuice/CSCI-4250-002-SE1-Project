@namespace GameboardComponents
@using GameLibrary.Models.Locations
@using GameLibrary.Models
@using GameLibrary.Interfaces
@using System.Drawing
@using static GameLibrary.Services.GameController

<div>
    <div style="float:left">
        <button @onmouseover="MouseHover" @onmouseout="MouseExit" @onclick="LocationClick">
            @if (IsOverButton == false) 
            {
                <p front-title>@Location.Name</p>
            }
            else if (IsOverButton == true)
            {
                <p back-title>@Location.Name</p>
                <p back-details>
                    @if (Location != Gameboard.GetInstance().GetLocation("Overtime")) 
                    {
                        @GetSpaces() <br>
                    }

                    @((MarkupString)@GetResource())
                </p>
            }
        </button>
    </div>
    <div style="float:right">
    @for(int i = 0; i < @Gameboard.GetInstance().Players.Count; i++)
    {
        <p style="display: inline-block;padding-right:100px;">@((MarkupString)@GetFigures(@Gameboard.GetInstance().Players.ToArray()[i], @Gameboard.GetInstance().GetLocation(@Location.Name).Name))</p>
        <br>
    } 
    </div>
    
</div>

<style>
    button {
        width: 175px;
        height: 135px;
        border: none;
        display: inline-block;
        transition-duration: 0.4s;
    }
    .buttonStyle
    {

    }
    p[front-title] {
        font-size: larger;
        font-weight: bolder;
    }
    p[back-title] {
        height: 20%;
        z-index: 1;
        font-size: medium;
        font-weight: bolder;
    }
    p[back-details] {
        height: 85%;
        font-size: small;
        z-index: 2;
    }
</style>

@code {
    public bool IsOverButton { get; set; } = false;


    [Parameter]
    public ILocation Location { get; set; }

    [Parameter]
    public EventCallback<MouseEventArgs> LocationClick { get; set; }

    public void MouseHover() {
        IsOverButton = true;
    }

    public void MouseExit() {
        IsOverButton = false;
    }

    public string GetSpaces() {
        string details = string.Empty;


        if (Location != Gameboard.GetInstance().GetLocation("Overtime")) {
            details += $"Spaces Left:  {Location.SpacesLeft}";
        }


        return details;
    }

    public string GetResource() {
        string details = string.Empty;

        if (Location is ResourceLocation) {
            ResourceLocation loc = (ResourceLocation)Location;
            details += $"Resource:     {loc.Resource}";
        }
        else if (Location is InvestmentField) {
            InvestmentField loc = (InvestmentField)Location;
            details += $"Resource:     Bitcoin Investment Level";
        }
        else if (Location is TrainingCenter) {
            TrainingCenter loc = (TrainingCenter)Location;
            details += $"Resource:     Add a Developer";
        }
        else if (Location is NerdLocation) {
            NerdLocation loc = (NerdLocation)Location;
            details += $"Resource:     Overclock Upgrade";
        }
        else if (Location is ConsultantCardLocation) {
            ConsultantCardLocation loc = (ConsultantCardLocation)Location;
            string resource = loc.Card.Upper.Resource.ToString();
            string number = loc.Card.Upper.Number.ToString();
            details += $"Resource: {resource} <br> Number: {number}";
        }
        else if (Location is LicenseTileLocation) 
        {
            LicenseTileLocation loc = (LicenseTileLocation)Location;

            string requiredResources = "";

            if(loc.Tile.RequiredResources != null)
            {
                foreach (Resources resource in loc.Tile.RequiredResources.Keys)
                {
                    requiredResources += resource.ToString();
                    requiredResources += ", ";
                }
            }
            


            string tileType = loc.Tile.Type.ToString();
            string numResources = loc.Tile.NumResources.ToString();
            string resourceTypes = loc.Tile.NumResourceTypes.ToString();
            if(loc.Tile.Type == LicenseTileType.FIXED_RESOURCES)
            {
                 details += $"Resource: {requiredResources} <br> Tile Type: {tileType} <br> Required Resources: {requiredResources}";
            }
            else if(loc.Tile.Type == LicenseTileType.FIXED_NUM_RESOURCES)
            {
                details += $"Resource Types Number: {resourceTypes} <br> Tile Type: {tileType} <br> Number of Resources: {numResources}";
            }
            else
            {
                details += $"Number of Resources: {numResources} <br> Tile Type: {tileType}";
            }
           
        }


        return details;
    }


    public string GetConsCardDetails()
    {
        string consultantCardDetails = null;
        consultantCardDetails = Gameboard.GetInstance().CurrentPlayer.Board.ConsultantCards[^1].Upper.Components.ToString();
        return consultantCardDetails;
    }

    public string GetFigures(Player p, string location)
    {
        string color = "";
        if(p.FigColor.ToUpper() == "RED")
        {
            color = $"&#x1F534";
        }
        else if(p.FigColor.ToUpper() == "YELLOW")
        {
            color = $"&#x1F7E1";
        }
        else if(p.FigColor.ToUpper() == "BLUE")
        {
            color = $"&#x1F535";
        } 
        else
        {
            color = $"&#x1F7E2";
        }

        return color + " " + Gameboard.GetInstance().GetLocation(location).GetNumPlayerDevelopers(p).ToString();
    }
}
